---
- hosts: "{{ variable_host }}"
  gather_facts: no
  tasks:
  - name: call terraform
    include_role: 
      #name: "{{ iac.providers[0].type }}"
      #TODO: hardcoded
      name: "libvirt"
    when: iac.providers[0].type == "libvirt"

- hosts: all
  gather_facts: no
  tasks:
  - meta: refresh_inventory

  - name: print inventory
    debug:
      var: hostvars | list
    run_once: true

#  - name: stop here after terraform destroy
#    fail:
#      msg: "stop here after terraform destroy"
#    when: terraform_action == "destroy"

#  - meta: end_batch
#    when: terraform_action == "destroy"

- hosts: base
  roles:
  - base

- hosts: kubernetes-tools
  roles:
  - kubernetes-tools

- hosts: elkstack
  roles:
  - elkstack
 
- hosts: k3s
  roles:
  - k3s

- hosts: rke2
  roles:
  - rke2

- hosts: argocd
  roles:
  - argocd

- hosts: openshift
  roles:
  - openshift

- hosts: localhost
  tasks:
  - name: print message
    ansible.builtin.debug: 
      msg: "{{ iac.message }}"
    when: iac.message is defined
